<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å±æ§ 27 å±¤ - åŠ å¼·ç‰ˆ</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap');

        body {
            background-color: #050505;
            color: #d1d1d1;
            font-family: 'Noto Sans TC', monospace;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
        }

        #game-container {
            width: 800px;
            max-width: 95%;
            height: 95vh;
            background: #141414;
            border: 1px solid #333;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.9);
            display: flex;
            flex-direction: column;
            position: relative;
        }

        /* é ‚éƒ¨ç‹€æ…‹åˆ— */
        #status-bar {
            display: flex;
            justify-content: space-between;
            padding: 12px 20px;
            background: #1f1f1f;
            border-bottom: 2px solid #333;
            font-size: 1rem;
            flex-wrap: wrap;
            gap: 10px;
        }

        .stat-box { display: flex; align-items: center; gap: 5px; }
        #hp-val { color: #ff4d4d; font-weight: bold;}
        #ammo-val { color: #ffd700; font-weight: bold;}
        #dist-val { color: #4dff88; font-weight: bold;}
        
        #inventory-display {
            font-size: 0.9rem;
            color: #aaa;
            margin-left: auto;
            border-left: 1px solid #444;
            padding-left: 15px;
        }
        .item-tag {
            background: #333;
            padding: 2px 6px;
            border-radius: 4px;
            margin-right: 5px;
            font-size: 0.8rem;
            color: #fff;
            border: 1px solid #555;
        }

        /* éŠæˆ²æ—¥èªŒå€åŸŸ */
        #game-log {
            flex-grow: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 12px;
            background: radial-gradient(circle at center, #1a1a1a 0%, #000 100%);
        }

        .log-entry {
            opacity: 0;
            animation: fadeIn 0.5s forwards;
            line-height: 1.6;
            font-size: 1.05rem;
            border-left: 3px solid transparent;
            padding-left: 10px;
        }

        .log-narrative { color: #bbb; border-left-color: #444; }
        .log-danger { color: #ff6b6b; border-left-color: #800; background: rgba(50, 0, 0, 0.2); }
        .log-success { color: #6bff95; border-left-color: #060; }
        .log-info { color: #66ccff; font-style: italic; }
        .log-item { color: #ffcc00; border-left-color: #aa8800; background: rgba(50, 40, 0, 0.2); }

        /* æ§åˆ¶å€ */
        #controls {
            padding: 15px;
            background: #1f1f1f;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            min-height: 120px;
            border-top: 1px solid #333;
        }

        button {
            background: #2b2b2b;
            color: #e0e0e0;
            border: 1px solid #444;
            padding: 12px;
            font-size: 1rem;
            cursor: pointer;
            font-family: 'Noto Sans TC', sans-serif;
            position: relative;
            overflow: hidden;
        }

        button:hover { background: #3a3a3a; border-color: #666; }
        button:active { background: #222; transform: translateY(1px); }
        
        button.danger-btn { border-color: #622; background: #2a1111; color: #ffbaba; }
        button.danger-btn:hover { background: #3a1515; }

        button.special-btn { border-color: #652; background: #2a2511; color: #fff8ba; }
        button.special-btn:hover { background: #3a3515; }

        /* ç‰¹æ•ˆ */
        @keyframes fadeIn { from { opacity: 0; transform: translateX(-10px); } to { opacity: 1; transform: translateX(0); } }
        
        .shake { animation: shake 0.4s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes shake {
            10%, 90% { transform: translate3d(-2px, 0, 0); }
            20%, 80% { transform: translate3d(4px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-6px, 0, 0); }
            40%, 60% { transform: translate3d(6px, 0, 0); }
        }

        .blood-overlay {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            box-shadow: inset 0 0 100px rgba(255, 0, 0, 0.5);
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.5s;
            z-index: 10;
        }

        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #111; }
        ::-webkit-scrollbar-thumb { background: #444; border-radius: 3px; }

    </style>
</head>
<body>

<div id="game-container">
    <div class="blood-overlay" id="blood-overlay"></div>
    <div id="status-bar">
        <div class="stat-box">â¤ï¸ <span id="hp-val">100</span>%</div>
        <div class="stat-box">ğŸ”« <span id="ammo-val">6</span></div>
        <div class="stat-box">ğŸ¢ å±¤æ•¸: <span id="dist-val">27</span></div>
        <div id="inventory-display">ğŸ’ ç©º</div>
    </div>
    
    <div id="game-log"></div>
    
    <div id="controls"></div>
</div>

<script>
    // --- éŠæˆ²æ ¸å¿ƒæ•¸æ“š ---
    const state = {
        hp: 100,
        ammo: 6,
        floors: 27, // æ”¹ç‚ºå±¤æ•¸å€’æ•¸
        isGameOver: false,
        inventory: {
            axe: false,      // æ¶ˆé˜²æ–§ï¼šå¤§å¹…æé«˜è¿‘æˆ°å‹ç‡
            keycard: false,  // é–€ç¦å¡ï¼šå¯ä»¥æ­é›»æ¢¯è·³å±¤
            adrenaline: false // è…ä¸Šè…ºç´ ï¼šä¸€æ¬¡æ€§å¾©æ´»æˆ–é€ƒè·‘
        }
    };

    const ui = {
        hp: document.getElementById('hp-val'),
        ammo: document.getElementById('ammo-val'),
        dist: document.getElementById('dist-val'),
        inv: document.getElementById('inventory-display'),
        log: document.getElementById('game-log'),
        controls: document.getElementById('controls'),
        container: document.getElementById('game-container'),
        blood: document.getElementById('blood-overlay')
    };

    // --- å·¥å…·å‡½å¼ ---
    function log(text, type = 'narrative') {
        const div = document.createElement('div');
        div.className = `log-entry log-${type}`;
        div.innerHTML = text;
        ui.log.appendChild(div);
        ui.log.scrollTop = ui.log.scrollHeight;
    }

    function updateUI() {
        ui.hp.innerText = state.hp;
        ui.ammo.innerText = state.ammo;
        ui.dist.innerText = state.floors;
        
        // æ›´æ–°èƒŒåŒ…é¡¯ç¤º
        let items = [];
        if (state.inventory.axe) items.push('<span class="item-tag">ğŸª“ æ¶ˆé˜²æ–§</span>');
        if (state.inventory.keycard) items.push('<span class="item-tag">ğŸ’³ é–€ç¦å¡</span>');
        if (state.inventory.adrenaline) items.push('<span class="item-tag">ğŸ’‰ è…ä¸Šè…ºç´ </span>');
        ui.inv.innerHTML = items.length > 0 ? items.join('') : 'ğŸ’ ç©º';

        // è¡€é‡ç‰¹æ•ˆ
        ui.blood.style.opacity = state.hp <= 30 ? 1 : 0;
        ui.hp.style.color = state.hp <= 30 ? '#ff0000' : '#ff4d4d';
    }

    function shake() {
        ui.container.classList.remove('shake');
        void ui.container.offsetWidth; 
        ui.container.classList.add('shake');
    }

    function clearControls() { ui.controls.innerHTML = ''; }

    function addBtn(text, onClick, type = 'normal') {
        const btn = document.createElement('button');
        btn.innerHTML = text;
        if (type === 'danger') btn.classList.add('danger-btn');
        if (type === 'special') btn.classList.add('special-btn');
        btn.onclick = onClick;
        ui.controls.appendChild(btn);
    }

    function randomInt(min, max) { return Math.floor(Math.random() * (max - min + 1)) + min; }

    function takeDamage(amount) {
        state.hp -= amount;
        shake();
        log(`ğŸ’” ä½ å—åˆ°äº† ${amount} é»å‚·å®³ï¼`, 'danger');
        
        if (state.hp <= 0) {
            if (state.inventory.adrenaline) {
                state.hp = 30;
                state.inventory.adrenaline = false;
                log(`ğŸ’‰ ç€•æ­»ä¹‹éš›ï¼Œä½ å°‡è…ä¸Šè…ºç´ æ‰å…¥å¿ƒè‡Ÿï¼ä½ å¤§å£å–˜æ°£ï¼Œæ´»äº†éä¾†ï¼`, 'item');
                updateUI();
            } else {
                state.hp = 0;
                gameOver(false);
            }
        }
        updateUI();
    }

    // --- éŠæˆ²æµç¨‹ ---

    function initGame() {
        state.hp = 100;
        state.ammo = 6;
        state.floors = 1; // å¾1æ¨“é–‹å§‹
        state.isGameOver = false;
        state.inventory = { axe: false, keycard: false, adrenaline: false };
        ui.log.innerHTML = '';
        updateUI();
        
        log("ğŸ¥ <b>é†«é™¢ 1F å¤§å»³</b>", 'info');
        log("ç„¡ç·šé›»æ»‹æ»‹ä½œéŸ¿ï¼šã€27 æ¨“...é ‚æ¨“...åªæœ‰ä¸€æ¶ç›´å‡æ©Ÿ...ã€");
        log("ä½ æ‰‹è£¡æ¡è‘—ä¸€æŠŠåªæœ‰ 6 ç™¼å­å½ˆçš„æ‰‹æ§ã€‚é€™æ˜¯ä½ å”¯ä¸€çš„ä¾é ã€‚", 'narrative');
        
        sceneHallway();
    }

    function sceneHallway() {
        if (state.isGameOver) return;
        
        // å‹åˆ©åˆ¤å®š
        if (state.floors >= 27) {
            sceneRoof();
            return;
        }

        // éš¨æ©Ÿäº‹ä»¶æª¢æŸ¥
        const dice = Math.random();
        
        if (dice < 0.25) {
            // é­é‡æ•µäºº
            log(`ğŸ§Ÿ èµ°åˆ° ${state.floors} æ¨“æ¨“æ¢¯å£æ™‚ï¼Œä¸€éš»æ„ŸæŸ“è€…çªç„¶è½‰éé ­ç›¯è‘—ä½ ï¼`, 'danger');
            combat();
            return;
        } else if (dice > 0.90) {
            // ç‰¹æ®Šå€–å­˜è€…äº‹ä»¶
            survivorEvent();
            return;
        }

        clearControls();
        log(`<br>ğŸ“ <b>ç•¶å‰ä½ç½®ï¼šç¬¬ ${state.floors} å±¤èµ°å»Š</b>`, 'info');
        log("é€™å±¤æ¨“ç•°å¸¸å®‰éœï¼Œåªè½åˆ°é è™•é€šé¢¨ç®¡çš„è²éŸ³ã€‚", 'narrative');

        // æ¨™æº–é¸é …
        addBtn("ğŸƒ çˆ¬æ¨“æ¢¯ (æ¨é€² 1 å±¤)", () => {
            state.floors++;
            if (Math.random() > 0.8) {
                log("ä½ çµ†åˆ°äº†åœ°ä¸Šçš„å±é«”ï¼Œæ‘”äº†ä¸€è·¤ã€‚", 'danger');
                takeDamage(5);
            } else {
                log("ä½ å°å¿ƒç¿¼ç¿¼åœ°çˆ¬ä¸Šäº†ä¸‹ä¸€å±¤ã€‚", 'narrative');
            }
            updateUI();
            sceneHallway();
        });

        // æˆ¿é–“æ¢ç´¢é¸é … (éš¨æ©Ÿç”Ÿæˆæˆ¿é–“é¡å‹)
        const rooms = [
            { name: "è­¦è¡›å®¤", type: "security", icon: "ğŸ‘®" },
            { name: "èŒ¶æ°´é–“", type: "breakroom", icon: "â˜•" },
            { name: "å¯¦é©—å®¤", type: "lab", icon: "ğŸ§ª" }
        ];
        const randomRoom = rooms[randomInt(0, rooms.length - 1)];

        addBtn(`${randomRoom.icon} æœç´¢${randomRoom.name} (å¯èƒ½æœ‰ç‰©è³‡)`, () => {
            exploreRoom(randomRoom);
        }, 'special');

        // å¦‚æœæœ‰é–€ç¦å¡ï¼Œé¡¯ç¤ºæ­é›»æ¢¯é¸é …
        if (state.inventory.keycard) {
            addBtn("ğŸ’³ [é“å…·] æ­ä¹˜è²¨æ¢¯ (è·³é 3 å±¤)", () => {
                log("å—¶â€”â€”ï¼é›»æ¢¯é–€æ‰“é–‹äº†ï¼Œä½ è¿…é€ŸæŒ‰ä¸‹æŒ‰éˆ•ã€‚", 'item');
                state.floors += 3;
                // é–€ç¦å¡æœ‰æ©Ÿæœƒå¤±æ•ˆ
                if(Math.random() > 0.6) {
                    state.inventory.keycard = false;
                    log("é›»æ¢¯æŠµé”å¾Œï¼Œé–€ç¦å¡æ–·æˆäº†å…©åŠ...", 'narrative');
                }
                updateUI();
                sceneHallway();
            }, 'special');
        }
    }

    function exploreRoom(room) {
        clearControls();
        log(`ä½ æ¨é–‹äº† ${room.name} çš„é–€...`, 'narrative');
        const chance = Math.random();

        // è­¦è¡›å®¤é‚è¼¯ (æ­¦å™¨ç‚ºä¸»)
        if (room.type === "security") {
            if (chance < 0.4) {
                log("é€™è£¡æœ‰ä¸€éš»è½‰è®Šçš„è­¦è¡›å–ªå±ï¼å®ƒç©¿è‘—é˜²å½ˆè¡£ï¼", 'danger');
                combat(true); // å¼·æ•µ
            } else if (chance < 0.7) {
                const foundAmmo = randomInt(2, 5);
                state.ammo += foundAmmo;
                log(`é‹æ°£ä¸éŒ¯ï¼ä½ åœ¨æ§æ«ƒè£¡æ‰¾åˆ°äº† ${foundAmmo} ç™¼å­å½ˆã€‚`, 'success');
                backToHall();
            } else if (!state.inventory.axe) {
                state.inventory.axe = true;
                log(`ğŸª“ <b>ç²å¾—é“å…·ï¼šæ¶ˆé˜²æ–§ï¼</b> ä½ å¾ç‰†ä¸Šå–ä¸‹äº†é€™æŠŠæ²ˆé‡çš„åˆ©å™¨ã€‚`, 'item');
                backToHall();
            } else {
                log("é€™è£¡åªæœ‰å¹¾å€‹ç©ºç”œç”œåœˆç›’å­ï¼Œä»€éº¼éƒ½æ²’æœ‰ã€‚", 'narrative');
                backToHall();
            }
        } 
        // èŒ¶æ°´é–“é‚è¼¯ (å›å¾©ç‚ºä¸»)
        else if (room.type === "breakroom") {
            if (chance < 0.3) {
                log("è‡ªå‹•è²©è³£æ©Ÿå¾Œé¢çˆ¬å‡ºä¸€éš»æ²’æœ‰è…¿çš„å–ªå±ï¼", 'danger');
                combat(); // å¼±æ•µ
            } else if (chance < 0.8) {
                const heal = randomInt(15, 30);
                state.hp = Math.min(100, state.hp + heal);
                log(`ä½ æ‰¾åˆ°äº†ä¸€ç½éæœŸçš„èƒ½é‡é£²æ–™ï¼Œå›å¾©äº† ${heal} é»ç”Ÿå‘½ã€‚`, 'success');
                backToHall();
            } else {
                log("åªæœ‰ç™¼éœ‰çš„å’–å•¡æ¸£ã€‚", 'narrative');
                backToHall();
            }
        }
        // å¯¦é©—å®¤é‚è¼¯ (ç‰¹æ®Šé“å…·/é«˜é¢¨éšª)
        else if (room.type === "lab") {
            if (chance < 0.5) {
                log("âš ï¸ è­¦å‘Šï¼å¯¦é©—å®¤æ´©æ¼äº†æœ‰æ¯’æ°£é«”ï¼", 'danger');
                takeDamage(15);
                backToHall();
            } else if (chance < 0.7 && !state.inventory.adrenaline) {
                state.inventory.adrenaline = true;
                log(`ğŸ’‰ <b>ç²å¾—é“å…·ï¼šè…ä¸Šè…ºç´ ï¼</b> é€™æ±è¥¿åœ¨é—œéµæ™‚åˆ»èƒ½æ•‘ä½ ä¸€å‘½ã€‚`, 'item');
                backToHall();
            } else if (chance >= 0.7 && !state.inventory.keycard) {
                state.inventory.keycard = true;
                log(`ğŸ’³ <b>ç²å¾—é“å…·ï¼šä¸»ç®¡é–€ç¦å¡ï¼</b> ä¹Ÿè¨±å¯ä»¥ç”¨ä¾†å•Ÿå‹•è²¨æ¢¯ã€‚`, 'item');
                backToHall();
            } else {
                log("é€™è£¡å…¨æ˜¯ç ´ç¢çš„è©¦ç®¡å’Œè¡€è·¡ã€‚", 'narrative');
                backToHall();
            }
        }
        updateUI();
    }

    function backToHall() {
        addBtn("å›åˆ°èµ°å»Š", sceneHallway);
    }

    function survivorEvent() {
        clearControls();
        log("ğŸ‘¥ <b>çªç™¼äº‹ä»¶</b>ï¼šä½ é‡åˆ°äº†ä¸€å€‹å—å‚·çš„é†«ç”Ÿï¼Œä»–é åœ¨ç‰†é‚Šã€‚", 'info');
        log("é†«ç”Ÿï¼šã€Œæ±‚æ±‚ä½ ...çµ¦æˆ‘ä¸€å€‹ç¹ƒå¸¶...æˆ–è€…ä¸€é¡†å­å½ˆçµæŸæˆ‘...ã€");

        addBtn("ğŸ’Š å¹«ä»–åŒ…ç´® (æ¶ˆè€— 15 HPçš„ç­‰å€¼é«”åŠ›)", () => {
            takeDamage(15); // æ¨¡æ“¬æ¶ˆè€—
            if (!state.isGameOver) {
                log("é†«ç”Ÿï¼šã€Œè¬è¬ä½ ...é€™å¼µå¡çµ¦ä½ ï¼Œæˆ‘ç”¨ä¸åˆ°äº†ã€‚ã€", 'success');
                if (!state.inventory.keycard) {
                    state.inventory.keycard = true;
                    log("ğŸ’³ ç²å¾—ï¼šé–€ç¦å¡", 'item');
                } else {
                    state.ammo += 3;
                    log("ä»–çµ¦äº†ä½ å¹¾ç™¼ç§è—çš„å­å½ˆã€‚", 'success');
                }
                updateUI();
                addBtn("é›¢é–‹", sceneHallway);
            }
        });

        addBtn("ğŸ”« æ¶åŠ«ä»– (å¯èƒ½ç²å¾—ç‰©è³‡)", () => {
            log("ä½ å†·è¡€åœ°æœåˆ®äº†ä»–çš„å£è¢‹ï¼Œç„¡è¦–ä»–çš„å“€åšã€‚", 'narrative');
            state.ammo += randomInt(1, 3);
            updateUI();
            addBtn("é›¢é–‹", sceneHallway);
        }, 'danger');
        
        addBtn("ğŸ‘‹ ç„¡è¦–ä¸¦é›¢é–‹", sceneHallway);
    }

    function combat(isTough = false) {
        clearControls();
        let enemyName = isTough ? "é‡è£è­¦è¡›å–ªå±" : "æ„ŸæŸ“è€…";
        
        addBtn(`ğŸ”« å°„æ“Š (å‰© ${state.ammo} ç™¼)`, () => {
            if (state.ammo > 0) {
                state.ammo--;
                // åŸºç¤å‘½ä¸­ç‡ 70%ï¼Œå¼·æ•µ 50%
                let hitChance = isTough ? 0.5 : 0.7;
                
                if (Math.random() < hitChance) {
                    log(`ğŸ’¥ ç °ï¼ä½ æ“Šå€’äº†${enemyName}ï¼`, 'success');
                    updateUI();
                    setTimeout(sceneHallway, 800);
                } else {
                    log("æ²’æ‰“ä¸­ï¼å®ƒæ’²ä¸Šä¾†äº†ï¼", 'danger');
                    takeDamage(isTough ? 25 : 15);
                    if(!state.isGameOver) combat(isTough);
                }
            } else {
                log("å¡æ­ï¼æ²’å­å½ˆäº†ï¼", 'danger');
                combat(isTough);
            }
        });

        // æ ¹æ“šæ˜¯å¦æœ‰æ–§é ­æ”¹è®Šè¿‘æˆ°é‚è¼¯
        if (state.inventory.axe) {
            addBtn("ğŸª“ æ¶ˆé˜²æ–§åŠˆç  (é«˜å‹ç‡)", () => {
                log("ä½ æ®èˆæ²ˆé‡çš„æ¶ˆé˜²æ–§åŠˆå‘å®ƒçš„è…¦è¢‹ï¼", 'narrative');
                if (Math.random() < 0.8) { // 80% å‹ç‡
                    log("å–€åš“ä¸€è²ï¼Œä¹¾æ·¨ä¿è½çš„æ–¬æ“Šï¼", 'success');
                    // æ–§é ­æœ‰å°æ©Ÿç‡å—å‚·
                    if(Math.random() > 0.7) {
                        log("ä½†ä½ åœ¨æ‹”å‡ºæ–§é ­æ™‚è¢«æŠ“å‚·äº†ã€‚", 'danger');
                        takeDamage(10);
                    }
                    if(!state.isGameOver) setTimeout(sceneHallway, 800);
                } else {
                    log("æ–§é ­å¡åœ¨ç‰†ä¸Šäº†ï¼ç³Ÿç³•ï¼", 'danger');
                    takeDamage(20);
                    if(!state.isGameOver) combat(isTough);
                }
            }, 'special');
        } else {
            addBtn("ğŸ‘Š å¾’æ‰‹æé¬¥ (æ¥µé«˜é¢¨éšª)", () => {
                log("ä½ ç¡¬è‘—é ­çš®è¡ä¸Šå»æ¨æ“ ï¼", 'narrative');
                if (Math.random() < 0.4) {
                    log("ä½ åƒ¥å€–æŠŠå®ƒæ¨ä¸‹æ¨“æ¢¯ã€‚", 'success');
                    takeDamage(randomInt(10, 20)); // å¿…å—å‚·
                    if(!state.isGameOver) setTimeout(sceneHallway, 800);
                } else {
                    log("ä½ è¢«å£“åˆ¶åœ¨åœ°ï¼Œè¢«ç‹ ç‹ å’¬äº†ä¸€å£ï¼", 'danger');
                    takeDamage(25);
                    if(!state.isGameOver) combat(isTough);
                }
            }, 'danger');
        }
    }

    function sceneRoof() {
        clearControls();
        log("<br>ğŸš <b>åˆ°é”é ‚æ¨“åœæ©Ÿåª</b>", 'info');
        log("æš´é›¨ä¸­ï¼Œç›´å‡æ©Ÿå°±åœ¨çœ¼å‰ï¼ä½†ä½ çš„èº«å¾Œå‚³ä¾†äº†å·¨éŸ¿ï¼", 'narrative');
        log("é ‚æ¨“çš„å®‰å…¨é–€è¢«æ’é–‹ï¼Œä¸€éš»è®Šç•°çš„ã€Œå¤œé­”ã€å¸¶è‘—å±ç¾¤è¡äº†å‡ºä¾†ï¼", 'danger');

        let bossHp = 3; // éœ€æˆåŠŸæ”»æ“Š3æ¬¡

        const bossFight = () => {
            if (state.isGameOver) return;
            if (bossHp <= 0) {
                gameOver(true);
                return;
            }

            log(`<br>âš ï¸ <b>æœ€çµ‚æ±ºæˆ°</b>ï¼šå¤œé­”æ­£åœ¨é€¼è¿‘ (é‚„éœ€æ“Šé€€ ${bossHp} æ¬¡)`, 'danger');
            clearControls();

            addBtn(`ğŸ”« å…¨åŠ›å°„æ“Š (${state.ammo})`, () => {
                if (state.ammo >= 1) {
                    state.ammo--;
                    if (Math.random() > 0.3) {
                        log("å­å½ˆæ‰“ä¸­äº†å¤œé­”çš„è‚©è†€ï¼Œå®ƒç™¼å‡ºæ…˜å«ï¼", 'success');
                        bossHp--;
                    } else {
                        log("å®ƒçš„å‹•ä½œå¤ªå¿«äº†ï¼ä½ æ‰“ç©ºäº†ï¼", 'danger');
                        takeDamage(20);
                    }
                } else {
                    log("æ²’æœ‰å­å½ˆäº†ï¼ä½ åªèƒ½è‚‰æï¼", 'danger');
                    takeDamage(10); // æ‡²ç½°
                }
                updateUI();
                bossFight();
            });

            if (state.inventory.axe) {
                addBtn("ğŸª“ æ¨èº«åŠˆç ", () => {
                    log("ä½ æ€’å¼è‘—è¡å‘å¤œé­”ï¼", 'item');
                    if (Math.random() > 0.4) {
                        log("æ¶ˆé˜²æ–§æ·±æ·±ç é€²å®ƒçš„èƒ¸å£ï¼", 'success');
                        bossHp--; 
                        takeDamage(15); // ä»¥å‚·æ›å‚·
                    } else {
                        log("ä½ è¢«å®ƒä¸€æŒæ‹é£›ï¼", 'danger');
                        takeDamage(30);
                    }
                    updateUI();
                    bossFight();
                }, 'special');
            }

            addBtn("ğŸƒ é–ƒé¿ç­‰å¾…æ©Ÿæœƒ", () => {
                if (Math.random() > 0.5) {
                    log("ä½ æ¼‚äº®çš„æ»‘éŸèº²éäº†è‡´å‘½ä¸€æ“Šã€‚", 'success');
                } else {
                    log("ä½ æ…¢äº†ä¸€æ­¥ï¼ŒèƒŒå¾Œè¢«åŠƒé–‹ä¸€é“å£å­ã€‚", 'danger');
                    takeDamage(20);
                }
                updateUI();
                bossFight();
            });
        };
        
        bossFight();
    }

    function gameOver(win) {
        state.isGameOver = true;
        clearControls();
        if (win) {
            log("<br>ğŸ† <b>ç”Ÿå­˜ç¢ºèª</b>", 'success');
            log("ä½ æŠ“ä½äº†ç›´å‡æ©Ÿçš„èµ·è½æ¶ï¼Œçœ‹è‘—åº•ä¸‹çš„é†«é™¢è¢«ç«æµ·åå™¬ã€‚", 'narrative');
            log(`æœ€çµ‚ç”Ÿå‘½å€¼: ${state.hp} | å‰©é¤˜å­å½ˆ: ${state.ammo}`);
        } else {
            log("<br>ğŸ’€ <b>æ­» äº¡</b>", 'danger');
            log("æ„è­˜é€æ¼¸æ¨¡ç³Š...ä½ æˆç‚ºäº†é€™æ£Ÿå¤§æ¨“çš„ä¸€éƒ¨åˆ†ã€‚", 'narrative');
        }
        addBtn("ğŸ”„ é‡æ–°é–‹å§‹", initGame);
    }

    // å•Ÿå‹•
    initGame();

</script>
</body>
</html>